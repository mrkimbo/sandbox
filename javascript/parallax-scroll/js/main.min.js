"use strict";var _raf=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;var scrollDiv=document.getElementById("scroll");var contentDiv=document.getElementById("content");var ball=document.getElementById("ball");var maxscroll=scrollDiv.scrollHeight-scrollDiv.clientHeight;var pos,diff,v=0;var touchPoint={x:ball.clientWidth*0.5,y:ball.clientHeight*0.5};var spd=0.01,vx,vy,dx,dy;var LEFT=-1,RIGHT=1,UP=-1,DOWN=1;var dragging=false;var ballXY={width:ball.clientWidth*0.5,height:ball.clientHeight*0.5};var log=function(a){if(window.console&&window.console.log){console.log.apply(console,arguments)}};contentDiv.addEventListener("mousewheel",onContentScroll,false);function onContentScroll(a){spd=0.01;scrollDiv.scrollTop-=a.wheelDelta*0.5}Hammer(ball,{drag_max_touches:1}).on("touch drag dragend",handleDrag);function handleSwipe(a){spd=0.01;switch(a.type){case"swipeleft":scrollDiv.scrollTop+=1000;break;case"swiperight":scrollDiv.scrollTop-=1000;break}}function handleDrag(a){if(!a.gesture){return}a.gesture.preventDefault();spd=0.01;switch(a.type){case"touch":dragging=true;vx=vy=0;break;case"drag":dx=a.gesture.srcEvent.pageX>touchPoint.x?RIGHT:LEFT;dy=a.gesture.srcEvent.pageY>touchPoint.y?DOWN:UP;vx=vy=0;touchPoint.x=a.gesture.srcEvent.pageX;touchPoint.y=a.gesture.srcEvent.pageY;break;case"dragend":dragging=false;vx=a.gesture.velocityX*dx;vy=a.gesture.velocityY*dy;log("Throw - direction: "+(dy==DOWN?"S":"N")+(dx==RIGHT?"E":"W")+", velocity: "+vx.toFixed(3)+","+vy.toFixed(3));break}_raf(update)}scrollDiv.onscroll=function(){_raf(update)};update();function update(){pos=scrollDiv.scrollTop/maxscroll;if(Math.abs(pos-v)<0.0001){v=pos}if(v!=pos){v+=(pos-v)*spd}document.querySelector("#s1 .bg").style.backgroundPosition=(v*650)+"% 0%";document.querySelector("#s1 .mountain").style.backgroundPosition=-(v*500)+"% 0%";if(!dragging&&Math.abs(vx)+Math.abs(vy)>0){touchPoint.x+=20*vx;touchPoint.y+=20*vy;vx*=0.98;vy*=0.98;if(Math.abs(vx)<0.01){vx=0}if(Math.abs(vy)<0.01){vy=0}constrainBall()}ball.style.left=touchPoint.x-ballXY.width+"px";ball.style.top=touchPoint.y-ballXY.height+"px";if(v!=pos||(Math.abs(vx)+Math.abs(vy))>0){_raf(update)}}function constrainBall(){if(touchPoint.x<ballXY.width){touchPoint.x=ballXY.width;vx*=-1}if(touchPoint.x>contentDiv.clientWidth-ballXY.width){touchPoint.x=contentDiv.clientWidth-ballXY.width;vx*=-1}if(touchPoint.y<ballXY.height){touchPoint.y=ballXY.height;vy*=-1}if(touchPoint.y>contentDiv.clientHeight-ballXY.height){touchPoint.y=contentDiv.clientHeight-ballXY.height;vy*=-1}}ball.onclick=function(){};