var Rotator=function(c,b,a){this._template=document.getElementById(b).innerHTML;this._container=c;this._onePerPage=true;this._pageDelay=2000;this._isMobile=a===true;this._touchDriven=false;EventDispatcher.init(this);Object.defineProperties(this,{pages:{get:function(){return this._pages}},results:{get:function(){return this._results}},pageIndex:{get:function(){return this._index}},isPaused:{get:function(){return this._paused}}})};Rotator.LEFT=0;Rotator.RIGHT=1;Rotator.ALIGN="TOP";Rotator.CHANGE="Rotator:onChange";Rotator.TOUCH="Rotator:onTouchInteraction";Rotator.prototype.init=function(d,c,b,a){this._index=this._timeout=-1;this._currentItem=this._nextItem=null;this._pages=[];this._paused=false;this._results=d;this._pageSize=c;this._maxPages=b;this._onePerPage=a;this._width=this._container.clientWidth;this._height=this._container.clientHeight;this._anim=null;this._lastDir=null;if(!isDef(c)){throw new Error("createEvents() - pageSize not defined")}if(this._results.length==1){this._results=this._splitSelections()}this._createPages();this.showPage(0)};Rotator.prototype._createPages=function(){var d=0,a=0,e,b,c;while(d<Math.min(this._results.length,this._maxPages)){if(!c){c='<div class="page" data-id="'+this._pages.length+'">';a=0}e=this._results[d];b=toArray(e.EventSelections).slice(0,this._pageSize);if(a+b.length>this._pageSize){this._createNode(c+"</div>");c="";d++;continue}c+=this._createGroup(b,e.parent.EventID.toString());if(this._onePerPage){this._createNode(c+"</div>");c=""}else{a+=b.length}d++}if(c.length){this._createNode(c+"</div>")}};Rotator.prototype._createGroup=function(b,c){var a='<div class="group" data-event="'+c+'">';each(b,function(d){a+=this._template.replace(/{NAME}/g,d.EventSelectionName.substr(0,23)).replace(/{ODDS}/g,d.Bet.Odds).replace(/{FLAG}/g,d.EventSelectionName.toLowerCase())},this);return a+"</div>"};Rotator.prototype._createNode=function(a){var b=document.createElement("div");b.innerHTML=a;this._pages[this._pages.length]=b.firstElementChild;b=null};Rotator.prototype._splitSelections=function(){var c=-1,b=-1,a,d=[],f;a=toArray(this._results[0].EventSelections);if(isDef(this._maxPages)){a=a.slice(0,this._pageSize*this._maxPages)}f=[];while(++b<a.length){f[f.length]=a[b];if(f.length%this._pageSize==0){d[d.length]={EventSelections:f,Type:this._results[0].Type,EachWayPlaces:this._results[0].EachWayPlaces,parent:this._results[0].parent};f=[]}}if(f.length){d[d.length]={EventSelections:f,Type:this._results[0].Type,EachWayPlaces:this._results[0].EachWayPlaces,parent:this._results[0].parent}}log("Rotator::SplitSelections("+a.length+") -> "+d.length+" pages");return d};Rotator.prototype.showPage=function(a){if(a<0||a>=this._pages.length||a==this._index||this._nextItem){return}var b=a>this._index?Rotator.LEFT:Rotator.RIGHT;this._createNextItem(a);this._animate(b)};Rotator.prototype.next=function(){if(this._nextItem){return}this._animate(Rotator.LEFT)};Rotator.prototype.prev=function(){if(this._nextItem){return}this._animate(Rotator.RIGHT)};Rotator.prototype._createNextItem=function(a){var b=a>this._index?Rotator.LEFT:Rotator.RIGHT;a=a<0?this._pages.length-1:a==this._pages.length?0:a;this._nextItem=this._pages[a];if(b==Rotator.LEFT){this._container.appendChild(this._nextItem)}else{this._container.insertBefore(this._nextItem,this._container.firstElementChild);this._container.style.left=(parseInt(this._container.style.left.replace(/px$/i,""))-this._nextItem.clientWidth)+"px"}this._alignPage()};Rotator.prototype._clearNextPage=function(){this._touchDriven=false;if(!this._nextItem){return}this._nextItem.parentNode.removeChild(this._nextItem);this._nextItem=this._anim=null;this._container.style.left=0};Rotator.prototype._animate=function(c,a){if(this._anim){return}if(!this._nextItem){this._createNextItem(this._index+(c==Rotator.LEFT?1:-1))}this._index=this._pages.indexOf(this._nextItem);if(!this._isMobile){this.dispatchEvent(Rotator.CHANGE,{index:this._index,element:this._nextItem,data:this._results[this._index],touch:this._touchDriven,target:this})}var b=c==Rotator.LEFT?-this._nextItem.clientWidth:0;if(this._currentItem){this._anim=TweenLite.to(this._container,a||0.6,{left:b,ease:Power2.easeOut,onComplete:bind(this._animComplete,this)})}else{this._animComplete()}};Rotator.prototype._alignPage=function(){var a=0;switch(Rotator.ALIGN.toLowerCase()){case"top":pos=0;break;case"center":case"middle":a=(this._height-this._nextItem.clientHeight)*0.5;break;case"bottom":a=this._height-this._nextItem.clientHeight;break}this._nextItem.style.top=a+"px"};Rotator.prototype._animComplete=function(){if(this._currentItem){this._currentItem.parentNode.removeChild(this._currentItem)}this._currentItem=this._nextItem;this._nextItem=this._anim=null;this._container.style.left=0;if(this._isMobile){this.dispatchEvent(Rotator.CHANGE,{index:this._index,element:this._currentItem,data:this._results[this._index],touch:this._touchDriven,target:this})}this._touchDriven=false;if(!this._paused){this._startAuto()}};Rotator.prototype.start=Rotator.prototype._startAuto=function(){this._killAuto();if(this._pages.length==1){return}this._paused=false;this._timeout=setTimeout(bind(this.next,this),this._pageDelay)};Rotator.prototype.stop=Rotator.prototype._killAuto=function(){this._paused=true;if(this._timeout!=-1){clearTimeout(this._timeout);this._timeout=-1}};Rotator.prototype.enableSwipeNavigation=function(){if(!isDef(window.Hammer)){throw new Error("Hammer.js not loaded");return}Hammer(document.getElementById("data-container"),{drag_max_touches:1,drag_block_vertical:true,drag_lock_to_axis:true}).on("touch release dragleft dragright swipeleft swiperight",bind(this._handleTouchEvent,this))};Rotator.prototype._handleTouchEvent=function(a){if(this._anim){return}a.gesture.preventDefault();this._touchDriven=true;switch(a.type){case"touch":var c=document.createEvent("Event");c.initEvent(Rotator.TOUCH,true);this._container.dispatchEvent(c);break;case"dragleft":if(this._lastDir==Rotator.RIGHT){this._clearNextPage()}if(!this._nextItem){this._createNextItem(this._index+1);this._lastDir=Rotator.LEFT}this._setDragPos(a.gesture.deltaX);break;case"dragright":if(this._lastDir==Rotator.LEFT){rotator._clearNextPage()}if(!this._nextItem){this._createNextItem(this._index-1);this._lastDir=Rotator.RIGHT}this._setDragPos(a.gesture.deltaX);break;case"swipeleft":this._nextItem?this._animate(Rotator.LEFT):this.prev();a.gesture.stopDetect();break;case"swiperight":this._nextItem?this._animate(Rotator.RIGHT):this.next();a.gesture.stopDetect();break;case"release":if(!this._nextItem){this._touchDriven=false;break}if(Math.abs(a.gesture.deltaX)>(this._nextItem.clientWidth*0.5)){this._animate(this._lastDir,0.3)}else{var b=0;if(this._lastDir==Rotator.RIGHT){b=-this._nextItem.clientWidth}this._anim=TweenLite.to(this._container,0.3,{left:b,ease:Power2.easeOut,onComplete:bind(this._clearNextPage,this)})}this._lastDir=null;break;default:this._lastDir=null;break}};Rotator.prototype._setDragPos=function(c){var a,d,b=this._nextItem.clientWidth;a=(100/b)*c;d=(b/100)*a;d=Math.max(-b,Math.min(b,d));if(this._lastDir==Rotator.RIGHT){d-=b}this._container.style.left=d+"px"};